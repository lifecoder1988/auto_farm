<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Web ç¼–ç¨‹æ¸¸æˆ (JavaScript)</title>
  <script id="ace-loader" src="https://cdn.jsdelivr.net/npm/ace-builds@1.32.0/src-min-noconflict/ace.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ace-builds@1.32.0/src-noconflict/ext-language_tools.js"></script>
  <style>
    :root{ --bg:#111;--panel:#1b1b1b;--panel2:#222;--ink:#eee;--accent:#4caf50;--grid:#555; }
    *{box-sizing:border-box}
    body {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto 1fr auto auto;
      grid-template-areas:
        "header header"
        "editor game"
        "footer footer"
        "console console";
      height: 100vh; margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: var(--bg); color: var(--ink);
    }
    header{grid-area:header; padding:10px 14px; background:var(--panel); border-bottom:1px solid #333; display:flex; gap:12px; align-items:center}
    header h1{font-size:16px;margin:0;opacity:.9}
    #lang-note{font-size:12px;opacity:0.8;color:#ccc;margin-left:auto;}
    #editor { grid-area: editor; height: calc(100vh - 120px); min-height: 300px; border-right:1px solid #333; }
    #game   { grid-area: game; display:flex; align-items:center; justify-content:center; background:var(--panel2); position:relative; }
    /* ç§‘æŠ€æ ‘è¦†ç›–å±‚ï¼ˆçª—å£çº§åˆ«ï¼‰ */
    #tech-overlay{ position:fixed; inset:0; z-index:1000; background:rgba(0,0,0,0.85); border:1px solid #333; border-radius:12px; padding:14px; display:none; color:#eee; }
    #tech-header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
    #tech-title{ font-weight:700; }
    #tech-close{ background:#3a3a3a; }
    /* ç§‘æŠ€æ ‘æ»šåŠ¨å®¹å™¨ä¸å…³ç³»å›¾ */
    #tech-scroll{ position:relative; height: calc(100% - 40px); overflow-y:auto; overflow-x:hidden; }
    #tech-graph{ position:relative; width:100%; min-height:100%; }
    .tech-node{ position:absolute; background:#1f1f1f; border:1px solid #444; border-radius:10px; padding:10px; width:300px; height:160px; overflow:hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.4); }
    .tech-node.unlocked{ border-color:#2d6a2d; }
    .tech-node.locked{ border-color:#6a2d2d; }
    .tech-node.clickable{ cursor:pointer; }
    .tech-name{ font-weight:600; margin-bottom:6px; text-align:center; font-size:16px; }
    .tech-status{ font-size:13px; opacity:.85; margin-bottom:6px; text-align:center; }
    .req{ font-size:13px; color:#ccc; text-align:center; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    canvas { background:#333; border:2px solid #555; width: 90%; height: 90%; max-width:520px; max-height:520px; }
    /* ä¸“ç”¨äºç§‘æŠ€æ ‘ Pixi ç”»å¸ƒï¼Œè¦†ç›–å…¨å±€ canvas é™åˆ¶ */
    #tech-canvas { 
      width: 100% !important; 
      height: 100% !important; 
      max-width: none !important; 
      max-height: none !important; 
      display: block !important;
      background: transparent !important; 
      border: 0 !important;
    }
    /* ä½œä¸ºå…œåº•ï¼šè‹¥ tech-canvas id å˜æ›´ï¼Œå®¹å™¨å†…çš„ canvas ä¹Ÿåº”æ’‘æ»¡ */
    #tech-graph > canvas { 
      width: 100% !important; 
      height: 100% !important; 
      max-width: none !important; 
      max-height: none !important; 
      display: block !important;
      background: transparent !important; 
      border: 0 !important;
    }
    footer{grid-area:footer; padding:10px 14px; background:var(--panel); border-top:1px solid #333; display:flex; gap:8px; align-items:center;}
    #console-panel{grid-area:console; background:var(--panel); border-top:1px solid #333;}
    #console{color:#ddd}
    #console > summary{cursor:pointer; padding:8px 14px; font-weight:600; list-style:none}
    #console-output{padding:8px 14px; height:160px; overflow-y:auto; overflow-x:hidden; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size:12px; line-height:1.5;}
    .log-line{white-space:pre-wrap; word-break:break-word}
    button { background: var(--accent); border: none; color: white; padding: 8px 16px; cursor: pointer; border-radius: 8px; font-weight:600; }
    button.secondary{ background:#3a3a3a }
    #msg{ margin-left: 8px; font-size: 12px; opacity:.9 }
    #inventory{ margin-left:20px; font-size:12px; }
  </style>
</head>
<body>
  <header>
    <h1>ç¼–ç¨‹å†œåœºå¼€æºç‰ˆ</h1>
    <span id="msg">ç­‰å¾…åˆå§‹åŒ–â€¦</span>
    <span id="inventory">ğŸ’ èƒŒåŒ…: </span>
    <span id="lang-note">ğŸŸ¨ å½“å‰è„šæœ¬è¯­è¨€ï¼šJavaScript</span>
    <button id="toggle-tech" class="secondary" style="margin-left:12px">ç§‘æŠ€æ ‘</button>
  </header>

  <div id="editor">// ç¤ºä¾‹ï¼š
// move('right')
// plant('åœŸè±†')
// move('down')
// harvest()

move('right')
plant('åœŸè±†')
move('down')
harvest()</div>

  <div id="game">
    <canvas id="map" width="400" height="400"></canvas>
    <div id="tech-overlay">
      <div id="tech-header">
        <div id="tech-title">ç§‘æŠ€æ ‘</div>
        <button id="tech-close" class="secondary">å…³é—­</button>
      </div>
      <div id="tech-scroll">
        <div id="tech-graph">
          
        </div>
      </div>
    </div>
  </div>

  <footer>
    <button id="run">è¿è¡Œ</button>
    <button id="reset" class="secondary">é‡ç½®</button>
    <label for="timeout-ms" style="margin-left:8px;font-size:12px;opacity:.85">è¶…æ—¶(ms)</label>
    <input id="timeout-ms" type="number" min="0" step="100" value="600000" style="width:90px;margin-left:6px;background:#2a2a2a;border:1px solid #444;color:#ddd;padding:4px 6px;border-radius:6px;">
  </footer>

  <div id="console-panel">
    <details id="console" open>
      <summary>æ§åˆ¶å°è¾“å‡º</summary>
      <div id="console-output"></div>
    </details>
  </div>
  <!-- å¼•å…¥ PixiJS æ¸¸æˆæ¡†æ¶ -->
  <script src="./asset/js/pixi.min.js"></script>
 
  <script type="module" src="js/main.js"></script>

</body>
</html>
