# 入门指南

欢迎来到编程农场！这是一个用 JavaScript 编写脚本来控制角色在 2D 地图上种地、收获并逐步解锁新玩法的学习型游戏。


## 界面速览

- 顶部栏：显示当前状态（已就绪/运行中等）、背包物品数量、脚本语言提示，以及“科技树”按钮。
- 左侧编辑器：Ace 编辑器，支持基本补全；初始区域内含示例代码与 API 列表。
- 右侧画布：游戏地图（PIXI 渲染）。
- 底部：运行、重置按钮与超时设置；下方“控制台输出”用于显示 `console.log` 等日志。

## 第一个脚本

在编辑器中输入并点击“运行”：

```
move('right')
plant('土豆')
move('down')
harvest()
```

这段脚本会让角色向右移动一格、种下一棵土豆，再向下移动一格并尝试收获当前格子的作物。

## 常用脚本 API

以下为核心 API（书写时无需显式 `await`，系统会自动为动作插入等待）：

- `move(dir)`：移动角色。`dir` 为 `'up'|'down'|'left'|'right'`。
- `plant(type)`：在当前位置种植作物。支持：`'土豆'`、`'南瓜'`。
- `harvest(entityId?)`：收获当前位置的成熟作物。
- `canHarvest(entityId?)`：当前格子是否可收获（成熟）。
- `getPlayer()`：获取当前激活实体的信息。
- `setActive(id)`：切换当前激活实体。
- `spawn(async (ctx) => { ... })`：生成一个分身并并行执行回调；`ctx` 包含 `id、move、plant、harvest` 等。
- `getEntity(id)`、`getPosition(id)`：读取实体信息或位置。
- `doAFlip(entityId?)`：让实体闪烁一会作为“动作反馈”。
- `changeCharacter(type, entityId?)`：切换角色外形：`'dino'|'drone'|'snake'`。`change_character` 为别名。
- `delay(ms)`、`waitFrame()`：显式延时或等待一帧（循环中自动插入）。
- `getWorldSize()`、`setWorldSize(size)`：获取/设置世界尺寸（会重绘地图）。
- `getTileSize()`：获取单个格子的像素尺寸。
- `setSlowMode(boolean)`：是否启用“慢速动作链”（调试/演示更清晰）。
- `createMaze(size, entityId?)`：生成迷宫；在迷宫里只能按迷宫规则移动，且不能种植/收获。

示例：并行分身与角色切换

```
// 生成一个分身并执行一小段任务
await spawn(async ({ move, plant, harvest }) => {
  await move('right')
  await plant('土豆')
  await harvest()
})

// 切换为贪吃蛇模式（仅 move / changeCharacter 有效）
await changeCharacter('snake')
await move('right')
await move('down')
```

## 游戏模式

- 经典种地（Mode 1）：常规移动、种植、收获与解锁。
- 南瓜合并（Mode 2）：相邻且朝同一正方向的南瓜会发生合并。
- 贪吃蛇（Mode 3）：切换到 `'snake'` 后进入；此模式下仅 `move` 与 `changeCharacter` 生效。
  
  ![Snake 模式](../snapshot/snake.png)
- 迷宫（Mode 4）：通过 `createMaze(size)` 生成；到达宝藏后迷宫自动清空并获得奖励。
  
  ![迷宫模式](../snapshot/maze.png)
- 多线程（Mode 5）：通过 `spawn` 创造多个分身并行执行（蛇模式下不可用）。
  
  ![多线程示意](../snapshot/threads.png)

> 注意：处于迷宫中的格子无法种植或收获；移动受墙体限制。

## 科技树与解锁

- 点击顶部“科技树”按钮打开技术面板。收获特定物品会逐步解锁新功能与 API。
- 文档导航中的“解锁”栏目包含各项功能说明，例如“角色”“迷宫”“循环”等。

## 调试与日志

- 使用 `console.log(...)` 打印变量与状态，输出会显示在页面底部“控制台输出”区域。
- 常见问题：
  - 本地文件直接打开看不到图片：请使用静态服务器。
  - 运行时间过长：调整界面底部的“超时(ms)”或减少循环工作量。
  - 蛇模式下指令无效：该模式仅支持 `move` 与 `changeCharacter`。

## 进阶建议

- 尝试将 `setWorldSize(12)` 与 `createMaze(3)` 组合，体验迷宫寻宝。
- 使用 `spawn` 将任务拆分并行执行；通过 `setActive(id)` 切换当前实体，与 `getPosition(id)` 读取状态。
- 在“内置函数”栏目探索更多能力（例如 `random`、`measure`、`till`、`useItem` 等），部分功能需要在科技树中解锁或在后续版本中提供。

## 下一步

- 从“作物”“物品”“地块”“内置函数”“解锁”等栏目深入了解每个能力与玩法。